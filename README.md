# bibliograph
docs for your data

```
virtualenv env
source env/bin/activate

pip install -r requirements.txt
```

## Running the app locally
```
chmod +x run.sh
./run.sh
```

## Making model changes
This repo uses Alembic to sync model changes with database migration files

1. Make your model change
2. `alembic revision --autogenerate "<Descriptive commit message>"`
3. Inspect the migration file generated. Autogenerated files are not infallible -- make sure the SQL commands are accurate and executed in the correct order!
4. If everything looks good: `alembic upgrade head`
5. To downgrade: `alembic downgrade`

See [Alembic Docs](https://alembic.sqlalchemy.org/en/latest/tutorial.html) for advanced usage.

## Running the Listener Service
The listener service continuously polls a given data warehouse and returns metadata to the local exabyte database. To run this service, simply edit the db_path in the bibliograph/run_listener.py file (line 35) to reflect the path to the sqlite db. Then, run:
```
python run_listener.py org_id [--run_interval] [--init]
```
`org_id` is a required argument that represents the org_id of the customer in question. `run_interval` is an optional argument that specifies how often the service should poll the data warehouse (in minutes). `init` is an optional flag. If this flag is raised, the service will initialize the local database with historical queries before polling for tables and columns. If you only want to initialize table/column metadata, you do not have to enable this flag.  
